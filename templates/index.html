<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Control Web - Analiza Wydatk√≥w</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üí∞ Budget Control Web</h1>
            <p>Analiza wydatk√≥w z wyciƒÖg√≥w bankowych</p>
        </header>

        <main>
            <!-- Sekcja uploadu pliku -->
            <section class="upload-section">
                <h2>üìÅ Prze≈õlij wyciƒÖg bankowy (CSV)</h2>
                
                {% if request.query_params.get('success') %}
                <div class="alert success">
                    ‚úÖ Analiza zosta≈Ça wykonana pomy≈õlnie!
                </div>
                {% endif %}
                
                {% if request.query_params.get('error') %}
                <div class="alert error">
                    ‚ùå B≈ÇƒÖd: {{ request.query_params.get('error') }}
                </div>
                {% endif %}
                
                <form action="/analyze" method="post" enctype="multipart/form-data" class="upload-form">
                    <div class="form-group">
                        <label for="csv_file">Wybierz plik CSV:</label>
                        <input type="file" id="csv_file" name="csv_file" accept=".csv" required>
                        <small>Plik powinien zawieraƒá kolumny: data, opis, kwota, saldo</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="week_start_date">Data rozpoczƒôcia tygodnia (opcjonalna):</label>
                        <input type="date" id="week_start_date" name="week_start_date">
                        <small>Pozostaw puste, aby automatycznie okre≈õliƒá tydzie≈Ñ</small>
                    </div>
                    
                    <button type="submit" class="btn-primary">
                        üîç ANALIZUJ WYDATKI
                    </button>
                </form>
            </section>

            <!-- Sekcja historii analiz -->
            <section class="history-section">
                <h2>üìä Historia Analiz</h2>
                
                {% if history %}
                <div class="history-grid">
                    {% for analysis in history %}
                    <div class="analysis-card">
                        <div class="card-header">
                            <h3>Tydzie≈Ñ {{ analysis.week_start }} - {{ analysis.week_end }}</h3>
                            <span class="analysis-date">{{ analysis.analysis_date[:10] }}</span>
                        </div>
                        
                        <div class="card-content">
                            <div class="stat-row">
                                <span class="stat-label">≈ÅƒÖczne wydatki:</span>
                                <span class="stat-value">{{ "%.2f"|format(analysis.total_expenses) }} z≈Ç</span>
                            </div>
                            
                            <div class="stat-row">
                                <span class="stat-label">≈örednio dziennie:</span>
                                <span class="stat-value">{{ "%.2f"|format(analysis.avg_daily_expense) }} z≈Ç</span>
                            </div>
                            
                            <div class="stat-row">
                                <span class="stat-label">Liczba transakcji:</span>
                                <span class="stat-value">{{ analysis.transaction_count }}</span>
                            </div>
                        </div>
                        
                        <div class="card-actions">
                            <button class="btn-secondary" onclick="showDetails({{ analysis.id }})">
                                üìã Szczeg√≥≈Çy
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p>üìù Brak analiz. Prze≈õlij pierwszy plik CSV, aby rozpoczƒÖƒá!</p>
                </div>
                {% endif %}
            </section>

            <!-- Sekcja zarzƒÖdzania kategoriami -->
            <section class="management-section">
                <h2>üè∑Ô∏è ZarzƒÖdzanie Kategoriami</h2>
                
                {% if nieprzypisane_count > 0 %}
                <div class="alert warning">
                    ‚ö†Ô∏è Masz {{ nieprzypisane_count }} nieprzypisanych transakcji wymagajƒÖcych kategoryzacji!
                </div>
                {% endif %}
                
                <div class="management-grid">
                    <div class="management-card">
                        <h3>üìã Rƒôczne przypisywanie</h3>
                        <p>Przypisz kategorie do nieprzypisanych transakcji i naucz system nowych regu≈Ç.</p>
                        <a href="/manual" class="btn-primary">Przejd≈∫ do przypisywania</a>
                    </div>
                    
                    <div class="management-card">
                        <h3>üìä Regu≈Çy kategoryzacji</h3>
                        <p>Zobacz i zarzƒÖdzaj regu≈Çami automatycznego przypisywania kategorii.</p>
                        <a href="/rules" class="btn-secondary">Zobacz regu≈Çy</a>
                    </div>
                </div>
            </section>

            <!-- Sekcja statystyk (przysz≈Ço≈õƒá) -->
            <section class="stats-section">
                <h2>üìà Statystyki i Por√≥wnania</h2>
                <div class="stats-placeholder">
                    <p>üîÆ W przysz≈Ço≈õci tutaj pojawiƒÖ siƒô:</p>
                    <ul>
                        <li>Por√≥wnania z poprzednimi tygodniami</li>
                        <li>Wykresy wydatk√≥w wed≈Çug kategorii</li>
                        <li>Trendy wydatk√≥w w czasie</li>
                        <li>Alerty o przekroczeniu bud≈ºetu</li>
                    </ul>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2024 Budget Control Web - Analiza wydatk√≥w z wyciƒÖg√≥w bankowych</p>
        </footer>
    </div>

    <!-- Modal dla szczeg√≥≈Ç√≥w analizy -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalBody">
                <!-- Zawarto≈õƒá bƒôdzie ≈Çadowana dynamicznie -->
            </div>
        </div>
    </div>

    <script>
        // Funkcja do pokazywania szczeg√≥≈Ç√≥w analizy
        function showDetails(analysisId) {
            // TODO: Implementacja AJAX do pobierania szczeg√≥≈Ç√≥w
            alert('Funkcja szczeg√≥≈Ç√≥w bƒôdzie dostƒôpna w przysz≈Çej wersji!');
        }

        // Obs≈Çuga modala
        const modal = document.getElementById('detailsModal');
        const span = document.getElementsByClassName('close')[0];

        span.onclick = function() {
            modal.style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html> 