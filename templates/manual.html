<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rƒôczne Przypisywanie Kategorii - Budget Control Web</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üè∑Ô∏è Rƒôczne Przypisywanie Kategorii</h1>
            <p>Przypisz kategorie do nieprzypisanych transakcji</p>
        </header>

        <main>
            <!-- Alerty -->
            {% if request.query_params.get('success') %}
            <div class="alert success">
                ‚úÖ {{ request.query_params.get('success') if request.query_params.get('success') != 'true' else 'Kategoria zosta≈Ça przypisana pomy≈õlnie!' }}
            </div>
            {% endif %}
            
            {% if request.query_params.get('error') %}
            <div class="alert error">
                ‚ùå B≈ÇƒÖd: {{ request.query_params.get('error') }}
            </div>
            {% endif %}

            <!-- Informacja o nowej analizie -->
            {% if new_analysis %}
            <div class="alert info">
                üìä Nowa analiza zosta≈Ça wykonana! Niekt√≥re transakcje wymagajƒÖ rƒôcznego przypisania kategorii.
            </div>
            {% endif %}

            <!-- Statystyki -->
            <section class="stats-section">
                <h2>üìà Statystyki</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Nieprzypisane transakcje</h3>
                        <p class="stat-number">{{ nieprzypisane|length }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Dostƒôpne kategorie</h3>
                        <p class="stat-number">{{ kategorie|length }}</p>
                    </div>
                </div>
            </section>

            <!-- Szybkie przypisywanie dla wszystkich -->
            {% if nieprzypisane %}
            <section class="bulk-assign-section">
                <h2>‚ö° Szybkie przypisywanie</h2>
                <form action="/manual/assign-all" method="post" class="bulk-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fraza">Fraza w opisie:</label>
                            <input type="text" id="fraza" name="fraza" placeholder="np. THAI WOK" required>
                        </div>
                        <div class="form-group">
                            <label for="kategoria_bulk">Kategoria:</label>
                            <select id="kategoria_bulk" name="kategoria" required>
                                <option value="">Wybierz kategoriƒô</option>
                                {% for kat in kategorie %}
                                <option value="{{ kat }}">{{ kat|title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn-primary">Przypisz do wszystkich pasujƒÖcych</button>
                    </div>
                </form>
            </section>
            {% endif %}

            <!-- Lista nieprzypisanych transakcji -->
            <section class="transactions-section">
                <h2>üìã Nieprzypisane transakcje</h2>
                
                {% if nieprzypisane %}
                <div class="transactions-list">
                    {% for trans in nieprzypisane %}
                    <div class="transaction-card">
                        <div class="transaction-header">
                            <h3>{{ trans.description }}</h3>
                            <span class="transaction-date">{{ trans.date.strftime('%Y-%m-%d') }}</span>
                        </div>
                        
                        <div class="transaction-details">
                            <div class="detail-row">
                                <span class="detail-label">Kwota:</span>
                                <span class="detail-value amount">{{ "%.2f"|format(trans.amount) }} z≈Ç</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Saldo:</span>
                                <span class="detail-value">{{ "%.2f"|format(trans.balance) }} z≈Ç</span>
                            </div>
                        </div>
                        
                        <form action="/manual/assign" method="post" class="assign-form">
                            <input type="hidden" name="transaction_id" value="{{ trans.id }}">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fraza_{{ trans.id }}">Fraza do zapisania (opcjonalna):</label>
                                    <input type="text" id="fraza_{{ trans.id }}" name="fraza" 
                                           placeholder="np. {{ trans.description[:20] }}..." 
                                           value="{{ trans.description[:30] }}">
                                </div>
                                
                                <div class="form-group">
                                    <label for="kategoria_{{ trans.id }}">Kategoria:</label>
                                    <select id="kategoria_{{ trans.id }}" name="kategoria" required>
                                        <option value="">Wybierz kategoriƒô</option>
                                        {% for kat in kategorie %}
                                        <option value="{{ kat }}">{{ kat|title }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <button type="submit" class="btn-secondary">Przypisz</button>
                            </div>
                        </form>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p>üéâ Brak nieprzypisanych transakcji! Wszystkie transakcje majƒÖ przypisane kategorie.</p>
                    <a href="/" class="btn-primary">Wr√≥ƒá do strony g≈Ç√≥wnej</a>
                </div>
                {% endif %}
            </section>

            <!-- Nawigacja -->
            <section class="navigation-section">
                <div class="nav-buttons">
                    <a href="/" class="btn-secondary">üè† Strona g≈Ç√≥wna</a>
                    <a href="/rules" class="btn-secondary">üìã Zobacz regu≈Çy kategoryzacji</a>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2024 Budget Control Web - Rƒôczne przypisywanie kategorii</p>
        </footer>
    </div>

    <script>
        // Automatyczne wype≈Çnianie frazy na podstawie opisu transakcji
        document.querySelectorAll('.assign-form').forEach(form => {
            const frazaInput = form.querySelector('input[name="fraza"]');
            const description = form.closest('.transaction-card').querySelector('h3').textContent;
            
            // Je≈õli fraza jest pusta, wype≈Çnij opisem
            if (!frazaInput.value) {
                frazaInput.value = description.substring(0, 30);
            }
        });
    </script>
</body>
</html> 